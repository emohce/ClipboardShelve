# ä¿®å¤ç‰ˆæŸ¥æ‰¾è·¯å¾„è„šæœ¬ï¼ˆé¿å…å˜é‡å†²çªï¼‰

## ğŸ¯ å®Œå…¨ä¿®å¤ç‰ˆè„šæœ¬

è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ï¼Œé¿å…å˜é‡é‡å¤å£°æ˜é”™è¯¯ï¼š

```javascript
// ===== ä¿®å¤ç‰ˆï¼šæŸ¥æ‰¾æ•°æ®åº“å’Œç›‘å¬ç¨‹åºè·¯å¾„ =====
// ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°é¿å…å˜é‡å†²çª

(function() {
  console.log('=== æŸ¥æ‰¾æ•°æ®åº“å’Œç›‘å¬ç¨‹åºè·¯å¾„ ===\n')

  // 1. è·å–è®¾ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰
  const setting = utools.dbStorage.getItem('setting')
  let dbPath

  if (!setting || !setting.database || !setting.database.path) {
    // ä½¿ç”¨é»˜è®¤è·¯å¾„
    const sep = require('path').sep
    dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
    console.log('âš ï¸ è®¾ç½®æœªåˆå§‹åŒ–ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„')
  } else {
    // ä»è®¾ç½®ä¸­è·å–è·¯å¾„
    const nativeId = utools.getNativeId()
    if (typeof setting.database.path === 'object') {
      dbPath = setting.database.path[nativeId] || setting.database.path[Object.keys(setting.database.path)[0]]
    } else {
      dbPath = setting.database.path
    }
    console.log('âœ… ä»è®¾ç½®ä¸­è·å–è·¯å¾„')
  }

  console.log('\nğŸ“ æ•°æ®åº“è·¯å¾„:')
  console.log('   ', dbPath)

  // è®¡ç®—ç›‘å¬ç¨‹åºä½ç½®
  const path = require('path')
  const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
  const platform = process.platform
  const listenerFileName = platform === 'win32' ? 'clipboard-event-handler-win32.exe' : 
                           platform === 'linux' ? 'clipboard-event-handler-linux' : 
                           'clipboard-event-handler-mac'
  const listenerPath = path.resolve(parentDir, listenerFileName)

  console.log('\nğŸ“‚ ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•:')
  console.log('   ', parentDir)
  console.log('\nğŸ“„ ç›‘å¬ç¨‹åºæ–‡ä»¶å:')
  console.log('   ', listenerFileName)
  console.log('\nğŸ¯ ç›‘å¬ç¨‹åºå®Œæ•´è·¯å¾„:')
  console.log('   ', listenerPath)

  // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  const { existsSync } = window.exports
  console.log('\nâœ… æ–‡ä»¶æ˜¯å¦å­˜åœ¨:')
  console.log('   ', existsSync(listenerPath) ? 'âœ… æ˜¯' : 'âŒ å¦ï¼ˆéœ€è¦ä¸‹è½½å¹¶æ”¾ç½®ï¼‰')
  
  console.log('\n=== æŸ¥æ‰¾å®Œæˆ ===')
})()
```

---

## ğŸ”§ è¶…ç®€ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

å¦‚æœä¸Šé¢çš„è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œä½¿ç”¨è¿™ä¸ªæœ€ç®€ç‰ˆæœ¬ï¼š

```javascript
// è¶…ç®€ç‰ˆæœ¬ - ç›´æ¥è®¡ç®—ï¼Œæ— å˜é‡å†²çª
(() => {
  const sep = require('path').sep
  const dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
  const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
  const platform = process.platform
  const fileName = platform === 'win32' ? 'clipboard-event-handler-win32.exe' : 
                   platform === 'linux' ? 'clipboard-event-handler-linux' : 
                   'clipboard-event-handler-mac'
  const path = require('path')
  const listenerPath = path.resolve(parentDir, fileName)

  console.log('ğŸ“ æ•°æ®åº“è·¯å¾„:', dbPath)
  console.log('ğŸ“‚ ç›‘å¬ç¨‹åºç›®å½•:', parentDir)
  console.log('ğŸ¯ ç›‘å¬ç¨‹åºè·¯å¾„:', listenerPath)
  console.log('ğŸ“„ æ–‡ä»¶å:', fileName)
})()
```

---

## ğŸ’¡ å¦‚æœè¿˜æ˜¯æŠ¥é”™

### æ–¹æ³• 1: åˆ·æ–°é¡µé¢

æŒ‰ `Ctrl + R` æˆ– `F5` åˆ·æ–°æ’ä»¶çª—å£ï¼Œæ¸…é™¤æ‰€æœ‰å˜é‡ï¼Œç„¶åé‡æ–°æ‰§è¡Œè„šæœ¬ã€‚

### æ–¹æ³• 2: ä½¿ç”¨ä¸åŒçš„å˜é‡å

```javascript
// ä½¿ç”¨å¸¦å‰ç¼€çš„å˜é‡å
const _dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${require('path').sep}_utools_clipboard_manager_storage`
const _parentDir = _dbPath.split('_utools_clipboard_manager_storage')[0]
const _platform = process.platform
const _fileName = _platform === 'win32' ? 'clipboard-event-handler-win32.exe' : 
                  _platform === 'linux' ? 'clipboard-event-handler-linux' : 
                  'clipboard-event-handler-mac'
const _listenerPath = require('path').resolve(_parentDir, _fileName)

console.log('æ•°æ®åº“è·¯å¾„:', _dbPath)
console.log('ç›‘å¬ç¨‹åºè·¯å¾„:', _listenerPath)
```

### æ–¹æ³• 3: ä¸€è¡Œç‰ˆæœ¬

```javascript
// ä¸€è¡Œç‰ˆæœ¬ï¼Œç›´æ¥è¾“å‡º
console.log('ç›‘å¬ç¨‹åºè·¯å¾„:', require('path').resolve(`${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${require('path').sep}_utools_clipboard_manager_storage`.split('_utools_clipboard_manager_storage')[0], process.platform === 'win32' ? 'clipboard-event-handler-win32.exe' : process.platform === 'linux' ? 'clipboard-event-handler-linux' : 'clipboard-event-handler-mac'))
```

---

## âœ… æ¨èä½¿ç”¨

**æ¨èä½¿ç”¨è¶…ç®€ç‰ˆæœ¬**ï¼Œå®ƒï¼š
- âœ… ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé¿å…å˜é‡å†²çª
- âœ… ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£
- âœ… ç›´æ¥è®¡ç®—é»˜è®¤è·¯å¾„ï¼Œä¸ä¾èµ–è®¾ç½®

ç›´æ¥å¤åˆ¶è¶…ç®€ç‰ˆæœ¬æ‰§è¡Œå³å¯ï¼
