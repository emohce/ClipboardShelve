# æŸ¥æ‰¾æ•°æ®åº“å’Œç›‘å¬ç¨‹åºè·¯å¾„

## ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è„šæœ¬

åœ¨ uTools æ’ä»¶çª—å£ä¸­ï¼ŒæŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç„¶ååœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š

```javascript
// ===== æŸ¥æ‰¾æ•°æ®åº“è·¯å¾„å’Œç›‘å¬ç¨‹åºä½ç½® =====

console.log('=== æŸ¥æ‰¾æ•°æ®åº“å’Œç›‘å¬ç¨‹åºè·¯å¾„ ===\n')

// 1. è·å–è®¾ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰
let setting = utools.dbStorage.getItem('setting')
if (!setting) {
  console.log('âš ï¸ è®¾ç½®æœªåˆå§‹åŒ–ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„è®¡ç®—...')
  // è®¡ç®—é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  const defaultPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
  setting = {
    database: {
      path: defaultPath
    }
  }
  console.log('   å·²ä½¿ç”¨é»˜è®¤è·¯å¾„:', defaultPath)
} else {
  console.log('âœ… è®¾ç½®å·²å­˜åœ¨')
}

// 2. è·å– nativeId
const nativeId = utools.getNativeId()
console.log('\nè®¾å¤‡ ID (nativeId):', nativeId)

// 3. è·å–æ•°æ®åº“è·¯å¾„
let dbPath
if (setting.database && setting.database.path) {
  if (typeof setting.database.path === 'object') {
    dbPath = setting.database.path[nativeId] || setting.database.path[Object.keys(setting.database.path)[0]] || Object.values(setting.database.path)[0]
  } else {
    dbPath = setting.database.path
  }
} else {
  // å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
}

console.log('\nğŸ“ æ•°æ®åº“è·¯å¾„:')
console.log('   ', dbPath)

// 4. è®¡ç®—ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•
const path = require('path')
const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
console.log('\nğŸ“‚ ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•:')
console.log('   ', parentDir)

// 5. æ ¹æ®æ“ä½œç³»ç»Ÿç¡®å®šç›‘å¬ç¨‹åºæ–‡ä»¶å
const platform = process.platform
const targetMap = {
  win32: 'clipboard-event-handler-win32.exe',
  linux: 'clipboard-event-handler-linux',
  darwin: 'clipboard-event-handler-mac'
}
const listenerFileName = targetMap[platform]
console.log('\nğŸ“„ ç›‘å¬ç¨‹åºæ–‡ä»¶å:')
console.log('   ', listenerFileName)

// 6. å®Œæ•´çš„ç›‘å¬ç¨‹åºè·¯å¾„
const listenerPath = path.resolve(parentDir, listenerFileName)
console.log('\nğŸ¯ ç›‘å¬ç¨‹åºå®Œæ•´è·¯å¾„:')
console.log('   ', listenerPath)

// 7. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
const { existsSync } = window.exports
const fileExists = existsSync(listenerPath)
console.log('\nâœ… ç›‘å¬ç¨‹åºæ–‡ä»¶æ˜¯å¦å­˜åœ¨:')
console.log('   ', fileExists ? 'âœ… æ˜¯' : 'âŒ å¦')

// 8. æ˜¾ç¤ºæ“ä½œæŒ‡å¼•
console.log('\nğŸ“‹ æ“ä½œæŒ‡å¼•:')
console.log('   1. ä¸‹è½½ç›‘å¬ç¨‹åºæ–‡ä»¶:', listenerFileName)
console.log('   2. å°†æ–‡ä»¶æ”¾åˆ°ä»¥ä¸‹ç›®å½•:')
console.log('      ', parentDir)
console.log('   3. å®Œæ•´è·¯å¾„åº”è¯¥æ˜¯:')
console.log('      ', listenerPath)
if (platform !== 'win32') {
  console.log('   4. è®¾ç½®æ‰§è¡Œæƒé™: chmod +x', listenerPath)
}

console.log('\n=== æŸ¥æ‰¾å®Œæˆ ===')
```

---

## ğŸ“ æ‰‹åŠ¨æŸ¥æ‰¾æ–¹æ³•

### æ–¹æ³• 1: é€šè¿‡è®¾ç½®é¡µæŸ¥çœ‹

1. æ‰“å¼€æ’ä»¶è®¾ç½®é¡µé¢ï¼ˆç‚¹å‡» ğŸ’¡ æŒ‰é’®ï¼‰
2. æŸ¥çœ‹ **"æ•°æ®åº“è·¯å¾„"** å­—æ®µ
3. æ•°æ®åº“è·¯å¾„é€šå¸¸æ˜¯ï¼š
   - **Windows**: `C:\Users\{ç”¨æˆ·å}\_utools_clipboard_manager_storage\database.json`
   - **macOS**: `~/Library/Application Support/_utools_clipboard_manager_storage/database.json`
   - **Linux**: `~/_utools_clipboard_manager_storage/database.json`

### æ–¹æ³• 2: é€šè¿‡æ§åˆ¶å°æŸ¥çœ‹

```javascript
// ç®€å•ç‰ˆæœ¬ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
let setting = utools.dbStorage.getItem('setting')
const nativeId = utools.getNativeId()

let dbPath
if (setting && setting.database && setting.database.path) {
  if (typeof setting.database.path === 'object') {
    dbPath = setting.database.path[nativeId] || setting.database.path[Object.keys(setting.database.path)[0]]
  } else {
    dbPath = setting.database.path
  }
} else {
  // ä½¿ç”¨é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
}

console.log('æ•°æ®åº“è·¯å¾„:', dbPath)
```

---

## ğŸ“‚ ç›‘å¬ç¨‹åºæ”¾ç½®ä½ç½®

### è§„åˆ™è¯´æ˜

ç›‘å¬ç¨‹åºå¿…é¡»æ”¾åœ¨**æ•°æ®åº“è·¯å¾„çš„çˆ¶ç›®å½•**ä¸­ã€‚

**ç¤ºä¾‹**ï¼š
- æ•°æ®åº“è·¯å¾„ï¼š`C:\Users\YourName\_utools_clipboard_manager_storage\database.json`
- ç›‘å¬ç¨‹åºåº”æ”¾åœ¨ï¼š`C:\Users\YourName\clipboard-event-handler-win32.exe`

### å„å¹³å°ç›‘å¬ç¨‹åºæ–‡ä»¶å

| æ“ä½œç³»ç»Ÿ | æ–‡ä»¶å |
|---------|--------|
| Windows | `clipboard-event-handler-win32.exe` |
| Linux | `clipboard-event-handler-linux` |
| macOS | `clipboard-event-handler-mac` |

---

## ğŸ” éªŒè¯è·¯å¾„æ˜¯å¦æ­£ç¡®

æ‰§è¡Œä»¥ä¸‹è„šæœ¬éªŒè¯ï¼š

```javascript
const path = require('path')
const { existsSync } = window.exports

// è·å–æ•°æ®åº“è·¯å¾„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
let setting = utools.dbStorage.getItem('setting')
const nativeId = utools.getNativeId()

let dbPath
if (setting && setting.database && setting.database.path) {
  if (typeof setting.database.path === 'object') {
    dbPath = setting.database.path[nativeId] || setting.database.path[Object.keys(setting.database.path)[0]]
  } else {
    dbPath = setting.database.path
  }
} else {
  // ä½¿ç”¨é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
}

// è®¡ç®—ç›‘å¬ç¨‹åºè·¯å¾„
const platform = process.platform
const targetMap = {
  win32: 'clipboard-event-handler-win32.exe',
  linux: 'clipboard-event-handler-linux',
  darwin: 'clipboard-event-handler-mac'
}
const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
const listenerPath = path.resolve(parentDir, targetMap[platform])

console.log('ç›‘å¬ç¨‹åºè·¯å¾„:', listenerPath)
console.log('æ–‡ä»¶æ˜¯å¦å­˜åœ¨:', existsSync(listenerPath))

// æ£€æŸ¥çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨
const { existsSync: fsExistsSync } = require('fs')
console.log('çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨:', fsExistsSync(parentDir))
console.log('çˆ¶ç›®å½•è·¯å¾„:', parentDir)
```

---

## ğŸ“ æ“ä½œæ­¥éª¤æ€»ç»“

### Windows ç”¨æˆ·

1. **æ‰¾åˆ°æ•°æ®åº“è·¯å¾„**ï¼š
   - é€šå¸¸æ˜¯ï¼š`C:\Users\{ä½ çš„ç”¨æˆ·å}\_utools_clipboard_manager_storage\database.json`
   - æˆ–æ‰§è¡Œä¸Šé¢çš„è„šæœ¬æŸ¥çœ‹

2. **ç¡®å®šç›‘å¬ç¨‹åºä½ç½®**ï¼š
   - ç›‘å¬ç¨‹åºåº”æ”¾åœ¨ï¼š`C:\Users\{ä½ çš„ç”¨æˆ·å}\clipboard-event-handler-win32.exe`

3. **ä¸‹è½½å¹¶æ”¾ç½®æ–‡ä»¶**ï¼š
   - ä¸‹è½½ `clipboard-event-handler-win32.exe`
   - æ”¾åˆ° `C:\Users\{ä½ çš„ç”¨æˆ·å}\` ç›®å½•

### Linux ç”¨æˆ·

1. **æ‰¾åˆ°æ•°æ®åº“è·¯å¾„**ï¼š
   - é€šå¸¸æ˜¯ï¼š`~/_utools_clipboard_manager_storage/database.json`

2. **ç¡®å®šç›‘å¬ç¨‹åºä½ç½®**ï¼š
   - ç›‘å¬ç¨‹åºåº”æ”¾åœ¨ï¼š`~/clipboard-event-handler-linux`

3. **ä¸‹è½½å¹¶è®¾ç½®æƒé™**ï¼š
   ```bash
   # ä¸‹è½½æ–‡ä»¶åˆ°ç”¨æˆ·ä¸»ç›®å½•
   # è®¾ç½®æ‰§è¡Œæƒé™
   chmod +x ~/clipboard-event-handler-linux
   ```

### macOS ç”¨æˆ·

1. **æ‰¾åˆ°æ•°æ®åº“è·¯å¾„**ï¼š
   - é€šå¸¸æ˜¯ï¼š`~/Library/Application Support/_utools_clipboard_manager_storage/database.json`

2. **ç¡®å®šç›‘å¬ç¨‹åºä½ç½®**ï¼š
   - ç›‘å¬ç¨‹åºåº”æ”¾åœ¨ï¼š`~/Library/Application Support/clipboard-event-handler-mac`

3. **ä¸‹è½½å¹¶è®¾ç½®æƒé™**ï¼š
   ```bash
   # ä¸‹è½½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•
   # è®¾ç½®æ‰§è¡Œæƒé™
   chmod +x ~/Library/Application\ Support/clipboard-event-handler-mac
   ```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æ‰¾ä¸åˆ°æ•°æ®åº“è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ‰§è¡Œä¸Šé¢çš„è„šæœ¬è‡ªåŠ¨æŸ¥æ‰¾
- æˆ–æŸ¥çœ‹è®¾ç½®é¡µä¸­çš„"æ•°æ®åº“è·¯å¾„"å­—æ®µ

### é—®é¢˜ 2: ä¸çŸ¥é“ç”¨æˆ·ä¸»ç›®å½•

**è§£å†³æ–¹æ¡ˆ**ï¼š

```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const os = require('os')
console.log('ç”¨æˆ·ä¸»ç›®å½•:', os.homedir())
```

### é—®é¢˜ 3: è·¯å¾„ä¸­æœ‰ç‰¹æ®Šå­—ç¬¦

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Windows: è·¯å¾„ä¸­çš„ç©ºæ ¼å’Œä¸­æ–‡é€šå¸¸æ²¡é—®é¢˜
- Linux/macOS: å¦‚æœè·¯å¾„æœ‰ç©ºæ ¼ï¼Œåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨å¼•å·ï¼š`"~/My Folder/clipboard-event-handler-linux"`

---

## ğŸ¯ ä¸€é”®å¤åˆ¶è·¯å¾„è„šæœ¬

æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼Œç›´æ¥å¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿ï¼ˆå¦‚æœæ”¯æŒï¼‰ï¼š

```javascript
// è·å–ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„å®Œæ•´è·¯å¾„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
let setting = utools.dbStorage.getItem('setting')
const nativeId = utools.getNativeId()

let dbPath
if (setting && setting.database && setting.database.path) {
  if (typeof setting.database.path === 'object') {
    dbPath = setting.database.path[nativeId] || setting.database.path[Object.keys(setting.database.path)[0]]
  } else {
    dbPath = setting.database.path
  }
} else {
  // ä½¿ç”¨é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
}

const path = require('path')
const platform = process.platform
const targetMap = {
  win32: 'clipboard-event-handler-win32.exe',
  linux: 'clipboard-event-handler-linux',
  darwin: 'clipboard-event-handler-mac'
}
const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
const listenerPath = path.resolve(parentDir, targetMap[platform])

console.log('ğŸ“‹ è¯·å¤åˆ¶ä»¥ä¸‹è·¯å¾„:')
console.log(listenerPath)
console.log('\nğŸ’¡ æç¤º: å°†ç›‘å¬ç¨‹åºæ–‡ä»¶æ”¾åˆ°ä¸Šè¿°è·¯å¾„')
```

---

## âœ… éªŒè¯æ¸…å•

æ”¾ç½®ç›‘å¬ç¨‹åºåï¼ŒéªŒè¯ï¼š

- [ ] ç›‘å¬ç¨‹åºæ–‡ä»¶å·²ä¸‹è½½
- [ ] æ–‡ä»¶å·²æ”¾åˆ°æ­£ç¡®çš„çˆ¶ç›®å½•
- [ ] æ–‡ä»¶åç§°å®Œå…¨æ­£ç¡®ï¼ˆåŒ…æ‹¬æ‰©å±•åï¼‰
- [ ] Linux/macOS å·²è®¾ç½®æ‰§è¡Œæƒé™
- [ ] é‡å¯æ’ä»¶åï¼Œè®¾ç½®é¡µæ˜¾ç¤º"å·²å®‰è£…"
- [ ] æ§åˆ¶å°æ£€æŸ¥ï¼š`window.listener.listening` ä¸º `true`
