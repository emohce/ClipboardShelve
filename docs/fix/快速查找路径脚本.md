# å¿«é€ŸæŸ¥æ‰¾è·¯å¾„è„šæœ¬ï¼ˆä¿®å¤ç‰ˆï¼‰

## ğŸ¯ ä¿®å¤åçš„å®Œæ•´è„šæœ¬

åœ¨ uTools æ’ä»¶çª—å£ä¸­ï¼ŒæŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹**ä¿®å¤åçš„è„šæœ¬**ï¼š

```javascript
// ===== æŸ¥æ‰¾æ•°æ®åº“è·¯å¾„å’Œç›‘å¬ç¨‹åºä½ç½®ï¼ˆä¿®å¤ç‰ˆï¼‰=====

console.log('=== æŸ¥æ‰¾æ•°æ®åº“å’Œç›‘å¬ç¨‹åºè·¯å¾„ ===\n')

// 1. è·å–è®¾ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰
// ä½¿ç”¨ var é¿å…é‡å¤å£°æ˜é”™è¯¯ï¼Œæˆ–å…ˆæ¸…é™¤å˜é‡
try { delete window._temp_setting } catch(e) {}
var setting = utools.dbStorage.getItem('setting')
if (!setting) {
  console.log('âš ï¸ è®¾ç½®æœªåˆå§‹åŒ–ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„è®¡ç®—...')
  // è®¡ç®—é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  const defaultPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
  setting = {
    database: {
      path: defaultPath
    }
  }
  console.log('   å·²ä½¿ç”¨é»˜è®¤è·¯å¾„:', defaultPath)
} else {
  console.log('âœ… è®¾ç½®å·²å­˜åœ¨')
}

// 2. è·å– nativeId
const nativeId = utools.getNativeId()
console.log('\nè®¾å¤‡ ID (nativeId):', nativeId)

// 3. è·å–æ•°æ®åº“è·¯å¾„ï¼ˆå¤„ç†å„ç§æƒ…å†µï¼‰
let dbPath
if (setting.database && setting.database.path) {
  if (typeof setting.database.path === 'object') {
    // æ–°ç‰ˆæœ¬ï¼špath æ˜¯å¯¹è±¡
    dbPath = setting.database.path[nativeId] || 
             setting.database.path[Object.keys(setting.database.path)[0]] || 
             Object.values(setting.database.path)[0]
  } else {
    // æ—§ç‰ˆæœ¬ï¼špath æ˜¯å­—ç¬¦ä¸²
    dbPath = setting.database.path
  }
} else {
  // å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„
  const sep = require('path').sep
  dbPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`
}

console.log('\nğŸ“ æ•°æ®åº“è·¯å¾„:')
console.log('   ', dbPath)

// 4. è®¡ç®—ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•
const path = require('path')
const parentDir = dbPath.split('_utools_clipboard_manager_storage')[0]
console.log('\nğŸ“‚ ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•:')
console.log('   ', parentDir)

// 5. æ ¹æ®æ“ä½œç³»ç»Ÿç¡®å®šç›‘å¬ç¨‹åºæ–‡ä»¶å
const platform = process.platform
const targetMap = {
  win32: 'clipboard-event-handler-win32.exe',
  linux: 'clipboard-event-handler-linux',
  darwin: 'clipboard-event-handler-mac'
}
const listenerFileName = targetMap[platform]
console.log('\nğŸ“„ ç›‘å¬ç¨‹åºæ–‡ä»¶å:')
console.log('   ', listenerFileName)

// 6. å®Œæ•´çš„ç›‘å¬ç¨‹åºè·¯å¾„
const listenerPath = path.resolve(parentDir, listenerFileName)
console.log('\nğŸ¯ ç›‘å¬ç¨‹åºå®Œæ•´è·¯å¾„:')
console.log('   ', listenerPath)

// 7. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
const { existsSync } = window.exports
const fileExists = existsSync(listenerPath)
console.log('\nâœ… ç›‘å¬ç¨‹åºæ–‡ä»¶æ˜¯å¦å­˜åœ¨:')
console.log('   ', fileExists ? 'âœ… æ˜¯' : 'âŒ å¦ï¼ˆéœ€è¦ä¸‹è½½å¹¶æ”¾ç½®ï¼‰')

// 8. æ˜¾ç¤ºæ“ä½œæŒ‡å¼•
console.log('\nğŸ“‹ æ“ä½œæŒ‡å¼•:')
console.log('   1. ä¸‹è½½ç›‘å¬ç¨‹åºæ–‡ä»¶:', listenerFileName)
console.log('   2. å°†æ–‡ä»¶æ”¾åˆ°ä»¥ä¸‹ç›®å½•:')
console.log('      ', parentDir)
console.log('   3. å®Œæ•´è·¯å¾„åº”è¯¥æ˜¯:')
console.log('      ', listenerPath)
if (platform !== 'win32') {
  console.log('   4. è®¾ç½®æ‰§è¡Œæƒé™: chmod +x', listenerPath)
}

console.log('\n=== æŸ¥æ‰¾å®Œæˆ ===')
```

---

## ğŸ”§ å¦‚æœè¿˜æ˜¯æŠ¥é”™

å¦‚æœæ‰§è¡Œåä»ç„¶æŠ¥é”™ï¼Œè¯·å°è¯•è¿™ä¸ª**æœ€ç®€ç‰ˆæœ¬**ï¼š

```javascript
// æœ€ç®€ç‰ˆæœ¬ - ç›´æ¥è®¡ç®—é»˜è®¤è·¯å¾„ï¼ˆé¿å…å˜é‡å†²çªï¼‰
(function() {
  const sep = require('path').sep
  const defaultPath = `${utools.isMacOs() ? utools.getPath('userData') : utools.getPath('home')}${sep}_utools_clipboard_manager_storage`

console.log('ğŸ“ æ•°æ®åº“è·¯å¾„ï¼ˆé»˜è®¤ï¼‰:')
console.log('   ', defaultPath)

const parentDir = defaultPath.split('_utools_clipboard_manager_storage')[0]
console.log('\nğŸ“‚ ç›‘å¬ç¨‹åºåº”è¯¥æ”¾ç½®çš„ç›®å½•:')
console.log('   ', parentDir)

const platform = process.platform
const listenerFileName = platform === 'win32' ? 'clipboard-event-handler-win32.exe' : 
                         platform === 'linux' ? 'clipboard-event-handler-linux' : 
                         'clipboard-event-handler-mac'

  const path = require('path')
  const listenerPath = path.resolve(parentDir, listenerFileName)
  console.log('\nğŸ¯ ç›‘å¬ç¨‹åºå®Œæ•´è·¯å¾„:')
  console.log('   ', listenerPath)
})()
```

---

## ğŸ’¡ è¯´æ˜

**ä¸ºä»€ä¹ˆä¼šå‡ºç°é”™è¯¯ï¼Ÿ**

- æ’ä»¶é¦–æ¬¡è¿è¡Œæ—¶ï¼Œè®¾ç½®å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–
- `utools.dbStorage.getItem('setting')` å¯èƒ½è¿”å› `null`
- ä¿®å¤åçš„è„šæœ¬ä¼šå¤„ç†è¿™ç§æƒ…å†µï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤è·¯å¾„

**é»˜è®¤è·¯å¾„è§„åˆ™ï¼š**

- **Windows/Linux**: `{ç”¨æˆ·ä¸»ç›®å½•}/_utools_clipboard_manager_storage`
- **macOS**: `{ç”¨æˆ·æ•°æ®ç›®å½•}/_utools_clipboard_manager_storage`

**ç›‘å¬ç¨‹åºä½ç½®ï¼š**

- ç›‘å¬ç¨‹åºå¿…é¡»æ”¾åœ¨æ•°æ®åº“è·¯å¾„çš„**çˆ¶ç›®å½•**ä¸­
- ä¾‹å¦‚ï¼šæ•°æ®åº“åœ¨ `C:\Users\YourName\_utools_clipboard_manager_storage\`
- ç›‘å¬ç¨‹åºåº”æ”¾åœ¨ï¼š`C:\Users\YourName\clipboard-event-handler-win32.exe`
